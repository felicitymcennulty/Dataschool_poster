---
title: Monitoring endangered Spotted Handfish populations
subtitle: 
short_title: Spotted handfish monitoring # Delete if not required

author:  Felicity McEnnulty
affiliation: CSIRO Oceans and Atmosphere # Or group/team
photo: resources/img/me.jpg

output: DSreport::project_summary
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  results = 'asis',
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center'
)

#Load libraries
library(tidyverse)
library(gapminder)
library(kableExtra)
```


# Introduction
I have a background in taxonomic identification of marine invertebrates and plankton. This requires working with data sets of species data and associated environmental data, spatial details and imagery. I have been involved in fieldwork using SCUBA diving to survey for introduced marine pests in Australian ports and to conduct underwater visual counts for species monitoring. I have used Excel, Access and SQL databases to manage data and have some experience in coding using Oracle to manage data and and R to produce graphs.


# My Project

The spotted handfish, _Brachionichthys hirsutus_, is a small marine fish that "walks on its hands" on the bottom sediments rather than swimming. Its distribution has been heavily impacted on by human activities such as scallop dredging and also by predation by an introduced seastar _Amurensis australis_. It is now restricted to a small area in southern Tasmania. The project data presented here examines the changes in the distribution of the handfish since monitoring of the population began at CSIRO in the late 1990's.

```{r Figure1, echo=FALSE, out.width= "50%", fig.cap = "Spotted handfish, Brachionichthys hirsutus"}
knitr::include_graphics("resources/img/Handfish.jpg")
```


## Preliminary results
Initially, from 1996- 2009 divers swam 100 metre underwater transects and counted the number of fish seen. This historic dataset was entered into Excel More recently, divers have towed a gps float and marked the position of each fish while swimming a variable length transect. This recent dataset was entered into Access.

Using the skills I have learnt in dataschool I have been able to "tidy" the 2 datasets using the tidyverse so they could be joined together. To do this I used *rename* to remove the spaces from my column names and to make the headings consistent between the 2 data files; *mutate* to change the count column from characters to numbers to enable statistical analyses; *filter* to remove those unnecessary data rows; and *select* to remove the unnecessary data columns. I also used *group_by*, *arrange* and *summarise* to rearrange my tidy datasets

*******add in the button to only show code on click******
```{r tidydata_show on click,echo=FALSE, results='hide'}
library(tidyverse)
library(lubridate)

Historic_spotted <- read_csv("Data/Historic_spotted.csv")
glimpse(Historic_spotted)

#tidy historic dataset 
  #rename variables and fix numbers to numeric
  #filter(On_transect == "Y")
  #fix date to date, add year as variable (needs the package(lubridate))
  #calculate swath area for each transect
  #note: use Transect_no as Transect_ID is unique in the recent dataset

TidyHistoric <- 
  Historic_spotted %>% 
    rename("Sample_date" = "Sample Date", "Transect_no" = "Transect #", "Transect_length" = "Transect L", 
          "Transect_width" = "Transect W", "Fish_count" = "n (fish)", "On_transect" = "On Transect", 
          "Fish_total_length" = "Fish TL's") %>% 
    mutate(Fish_count = as.numeric(Fish_count), Fish_total_length = as.numeric(Fish_total_length)) %>%
    mutate(Sample_date = dmy(Sample_date)) %>% 
    mutate(Sample_year = year(Sample_date)) %>% 
    filter((On_transect == "Y")) %>% 
    mutate(Swath_Area = (Transect_length * Transect_width )) %>% 
    mutate(Loc_abbr = str_sub(Location, start = 1, end = 4))

TidyHistoric <- TidyHistoric %>% 
                  select(-On_transect) %>%
                  arrange(Transect_no)
```

I learnt to use regular expression (regex) coding in R to use str_replace to edit my location names between the 2 datasets where there were spelling differences in the data tables. See the example code below:
```{r Regex_show code,echo=TRUE}
#the correct name for this location is Mary-Ann Bay, it is mis-spelt in the historic dataset
TidyHistoric <- TidyHistoric %>% mutate(Location = str_replace(Location,'Mary-Anne Bay', "Mary-Ann Bay"))
```

Another handy thing I learnt was how to add in a index column of row numbers, the sample code below was used to produce Table \@ref(tab:mytidytable) 
```{r more tidying_hide code and results, echo=FALSE, results='hide'}
#number of fish per transect by location
Historic_bytransect <- TidyHistoric %>% 
                        group_by(Location, Loc_abbr, Sample_date, Transect_no, Swath_Area) %>% 
                        summarise(Fish_count = n()) %>% 
                        rename ("Total_fish" = "Fish_count")
```

```{r add row numbers_show code, echo=TRUE,results= "hide"}

#add in a row number column
index_numbers <-  1:nrow(Historic_bytransect) # to count no. of rows in data frame
Historic_bytransect <- Historic_bytransect %>% 
                        ungroup %>% 
                        arrange(Sample_date) %>% 
                        mutate(Row_ID = index_numbers)
```


**Tables**
```{r mytidytable, out.width='100%', echo = F}
knitr::kable(head(Historic_bytransect, n = 5), format = "html", caption = "A tidy data table with row numbers") %>% 
  kable_styling("striped")
```

Hopefuly this will enable me to conduct some time-series analysis using GLMs.


**Plots from R**
```{r standard-plot, out.width='60%', fig.align='center', fig.height= 4, fig.width=6, fig.cap="Yet another gapminder plot"}
gapminder %>% 
  filter(year == 1987) %>% 
  ggplot(aes(x = gdpPercap, y = lifeExp, colour = continent, size = pop)) +
  geom_point() +
  scale_x_log10(labels = function(b) format(b, scientific = F)) +
  scale_size(trans = "sqrt", guide = "none") +
  scale_color_brewer(palette = "Set1") +
  theme_linedraw() +
  theme(legend.position = "bottom")
```

Your figure and table captions are automatically numbered and can be referenced in the text
if needed: see eg. Table \@ref(tab:mytable) and Figure \@ref(fig:standard-plot)

# My Digital Toolbox

![](resources/img/tidyverse.png){width=100px}

What digital tools have you been using in your project? Do you expect that everything will be able 
to be completed within R, or will you need to work with multiple tools to get the right result?
Which of the digital skills needed for your project have you learned since starting Data School?

You can use all the usual R markdown features in writing a project summary, including lists:

* R - dplyr, ggplot, ...
* Python
* SQL

## Favourite tool (optional)

Is there a tool/package/function in particular that you've enjoyed using? Give it a special shout out here. What about this tool makes it your favourite?

![](https://raw.githubusercontent.com/tidyverse/ggplot2/master/man/figures/logo.png){.pull-right width=100px}

No prizes for guessing mine:

# My time went ...

What parts of your project take the most time and effort? Were there any surprising challenges you
encountered, and how did you solve them?

# Next steps

What further steps do you wish your project could take? Or are there any new digital skills that you
are keen to develop as a result of your involvement in the Data School?

# My Data School Experience

This summary is mostly about your project. However we would also like to hear about other
parts of your Data School experience. What aspects of the program did you really enjoy? Have you
tried applying the skills you have learned in your daily work? Have you been able to transfer this 
knowledge to your team members? Any descriptions of the personal impact the program has 
had are welcome here as well!
